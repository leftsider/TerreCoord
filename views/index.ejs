<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <h1>üè° TerreCoord</h1>
        <p>Welcome to my "pied a terre" booking and coordination system! 
            <br><i>Vos s√©jours, vivez vos espaces!</i>
        </p>
        
        <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
            <div class="error">
                <% errors.forEach(function(error) { %>
                    <p><%= error %></p>
                <% }); %>
            </div>
        <% } %>
        <% if (typeof success !== 'undefined') { %>
            <div class="success">
                <p><%= success %></p>
            </div>
        <% } %>

        <div class="booking-form">
            <h2>Request Booking</h2>
            <form action="/booking" method="POST">
                <label for="dates">Select Dates:</label>
                <input 
                    type="date" 
                    id="start-date" 
                    name="startDate" 
                    required 
                    value="<%= (typeof formData !== 'undefined' && formData.startDate) ? formData.startDate : '' %>"
                >
                <input 
                    type="date" 
                    id="end-date" 
                    name="endDate" 
                    required 
                    value="<%= (typeof formData !== 'undefined' && formData.endDate) ? formData.endDate : '' %>"
                >
                
                <label for="name">Your Name:</label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    required 
                    value="<%= (typeof formData !== 'undefined' && formData.name) ? formData.name : '' %>"
                >
                
                <label for="email">Email:</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    required 
                    value="<%= (typeof formData !== 'undefined' && formData.email) ? formData.email : '' %>"
                >
                
                <button type="submit">Check Availability</button>
            </form>
        </div>
    </div>
    <!-- === DEBUG SECTION (comment out in production) === -->
<div class="debug-section" style="margin-top:2em; background:#f5f5f5; padding:15px; color:#222; border:1px dashed #888;">
  <h3>Debug Info</h3>
  <ul>
    <li><strong>Auth Established:</strong> <%= debug.authEstablished ? 'Yes' : 'No' %></li>
    <li><strong>Calendar in Use:</strong> <%= debug.calendarId %></li>
    <% if (debug.submittedDates) { %>
      <li><strong>Submitted Dates:</strong> <%= debug.submittedDates.startDate %> through <%= debug.submittedDates.endDate %></li>
    <% } %>
    <% if (debug.calendarEventMatch !== null) { %>
      <li>
        <strong>Booking Exists On Calendar:</strong>
        <%= typeof debug.calendarEventMatch === 'string'
              ? debug.calendarEventMatch
              : (debug.calendarEventMatch ? 'Yes' : 'No') %>
      </li>
    <% } %>
  </ul>
  <div><a href="/auth/google">Authenticate/Create Token</a></div>
  <div style="font-size:0.85em; color:#888;">
    (Remove or comment out this section for production.)
  </div>
</div>

</body>
</html>
